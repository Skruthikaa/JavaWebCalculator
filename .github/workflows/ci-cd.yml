      - name: üöÄ Deploy WAR to Tomcat (Force Clean)
        env:
          TOMCAT_USER: ${{ secrets.TOMCAT_USER }}
          TOMCAT_PASS: ${{ secrets.TOMCAT_PASS }}
          NEXUS_USER: ${{ secrets.NEXUS_USER }}
          NEXUS_PASS: ${{ secrets.NEXUS_PASS }}
        run: |
          set -e
          APP_NAME="webapp-add"
          cd /tmp; rm -f *.war

          echo "üîç Trying to fetch the latest WAR from Nexus (retry loop)..."
          DOWNLOAD_URL=""
          for i in {1..5}; do
            echo "‚è≥ Attempt $i/5..."
            DOWNLOAD_URL=$(curl -s -u ${NEXUS_USER}:${NEXUS_PASS} \
              "${{ env.NEXUS_URL }}/service/rest/v1/search/assets?repository=${{ env.NEXUS_REPO }}&group=${{ env.NEXUS_GROUP }}&name=${{ env.NEXUS_ARTIFACT }}" \
              | jq -r '.items[-1].downloadUrl')
            if [ -n "$DOWNLOAD_URL" ] && [ "$DOWNLOAD_URL" != "null" ]; then
              echo "‚úÖ Found WAR: $DOWNLOAD_URL"
              break
            fi
            echo "‚ö†Ô∏è WAR not found yet ‚Äî waiting 15s before retry..."
            sleep 15
          done

          if [ -z "$DOWNLOAD_URL" ] || [ "$DOWNLOAD_URL" = "null" ]; then
            echo "‚ùå Still no WAR found after 5 attempts!"
            echo "üîé Debug: Listing all items returned from Nexus:"
            curl -s -u ${NEXUS_USER}:${NEXUS_PASS} \
              "${{ env.NEXUS_URL }}/service/rest/v1/search/assets?repository=${{ env.NEXUS_REPO }}&group=${{ env.NEXUS_GROUP }}&name=${{ env.NEXUS_ARTIFACT }}"
            exit 1
          fi

          echo "‚¨áÔ∏è Downloading WAR: $DOWNLOAD_URL"
          curl -u ${NEXUS_USER}:${NEXUS_PASS} -O "$DOWNLOAD_URL"
          WAR_FILE=$(basename "$DOWNLOAD_URL")

          echo "üßπ Undeploying old app..."
          curl -u ${TOMCAT_USER}:${TOMCAT_PASS} "${{ env.TOMCAT_URL }}/undeploy?path=/${APP_NAME}" || true
          sleep 5

          echo "üöÄ Deploying new WAR..."
          curl -u ${TOMCAT_USER}:${TOMCAT_PASS} --upload-file "$WAR_FILE" \
            "${{ env.TOMCAT_URL }}/deploy?path=/${APP_NAME}&update=true"

          echo "‚úÖ Deployment completed successfully!"
